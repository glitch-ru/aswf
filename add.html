<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–°–æ–∫—Ä–∞—â–∞—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫ ‚Äî Admin</title>
<style>
  body { font-family: Arial; max-width: 700px; margin: 25px auto; }
  input,button { padding: 10px; font-size: 15px; width: 100%; margin: 6px 0; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  td,th { border-bottom: 1px solid #ddd; padding: 8px; }
</style>
</head>
<body>

<h2>–°–æ–∫—Ä–∞—â–∞—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫ (Admin)</h2>

<label>–ü–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞:</label>
<input id="fullUrl" placeholder="https://example.com">

<label>–ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ (–∏–ª–∏ –ø—É—Å—Ç–æ):</label>
<input id="shortCode" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: abc12">

<button onclick="createLink()">–°–æ–∑–¥–∞—Ç—å</button>

<hr>
<h3>–í—Å–µ —Å—Å—ã–ª–∫–∏</h3>
<div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<table id="linksTable">
  <thead>
    <tr><th>–ö–æ–¥</th><th>URL</th><th>–£–¥–∞–ª–∏—Ç—å</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const RAW = "https://jsonhosting.com/api/json/6f27b315/raw";
const API = "https://jsonhosting.com/api/json/6f27b315";
const EDIT_KEY = "4607b84db6df73492889f1cd1946a00ed5784551fc3c1f284dcadc5723c9f9ab";

function randCode(len=5){
    const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
    let s = "";
    for(let i=0;i<len;i++) s += chars[Math.floor(Math.random()*chars.length)];
    return s;
}

async function loadDB(){
    const res = await fetch(RAW);
    const data = await res.json();
    return typeof data === "object" ? data : {};
}

async function saveDB(obj){
    await fetch(API, {
        method: "POST",
        headers: { 
            "Content-Type": "application/json",
            "X-Api-Key": EDIT_KEY
        },
        body: JSON.stringify(obj)
    });
}

async function render(){
    document.getElementById("status").textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
    const db = await loadDB();

    const tbody = document.querySelector("#linksTable tbody");
    tbody.innerHTML = "";

    for(const code in db){
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${code}</td>
          <td><a href="${db[code]}" target="_blank">${db[code]}</a></td>
          <td><button onclick="del('${code}')">üóë</button></td>
        `;

        tbody.appendChild(tr);
    }

    document.getElementById("status").textContent = "–ì–æ—Ç–æ–≤–æ. –í—Å–µ–≥–æ: " + Object.keys(db).length;
}

async function createLink(){
    let url = document.getElementById("fullUrl").value.trim();
    let code = document.getElementById("shortCode").value.trim();

    if(!url){ alert("–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É"); return; }
    if(!code) code = randCode();

    const db = await loadDB();

    if(db[code] && !confirm("–ö–æ–¥ –∑–∞–Ω—è—Ç. –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å?")) return;

    db[code] = url;

    await saveDB(db);
    await render();

    alert("–°–æ–∑–¥–∞–Ω–æ: ?c=" + code);
}

async function del(code){
    if(!confirm("–£–¥–∞–ª–∏—Ç—å –∫–æ–¥: " + code + "?")) return;

    const db = await loadDB();
    delete db[code];
    await saveDB(db);
    await render();
}

render();
</script>

</body>
</html>
